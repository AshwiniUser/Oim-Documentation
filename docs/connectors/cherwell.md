# Prerequisites

## Service User

* Cherwell supports OAuth-based authentication. Users will need to generate a client ID and secret by following these steps:
* Follow the official Cherwell documentation: [https://help.ivanti.com/ch/help/en_US/CSM/10.1.0/documentation_bundle/system_administration/rest_api/csm_rest_obtaining_client_ids.html Obtaining Client IDs]
* The system requires the service user's ID to be provided in the system form because the username used for authentication cannot be used to identify the service user.

# System Configuration

Before configuring the integration, you must first configure Cherwell. Refer to [System Configuration](../integrate/system-configuration.md) page to learn the step-by-step process to configure a system.

Refer to the following screenshot with each field value chosen

<p align="center">
  <img src="../assets/CherwellSystemForm.png" width="550px" />
</p>

| **Field Name**                 | **When is the field visible** | **Description**                                                                                                                                         |
|-------------------------------|-------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------|
| **System Name**               | Always                        | Provide a name to the Cherwell system.                                                                                                                  |
| **Server URL**                | Always                        | Provide Server URL of the Cherwell instance. This URL will be used for communicating with Cherwell system API. The format: (http(s))://hostname:port/ |
| **Username**                  | Always                        | User name, this should be Domain/username. Example: cherwell/integration_user                                                                           |
| **User ID**                   | Always                        | ID of the user. Required as username used for authentication can't uniquely identify the integrated user.                                              |
| **Password**                  | Always                        | Password of the user.                                                                                                                                   |
| **Client ID**                 | Always                        | Provide the Client ID generated by user. See: [https://help.ivanti.com/ch/help/en_US/CSM/10.1.0/documentation_bundle/system_administration/rest_api/csm_rest_obtaining_client_ids.html Obtaining Client IDs] |
| **Fields to Override DataType** | Always                      | Provide the JSON where key is Field's internal name (If field ID has BO: and FI: then provide ID after FI:) and its DataType to be configured.         |
| **Timezone**                  | Always                        | This is a system-level config; API doesn't provide it. Example: GMT-05:00 for Eastern Standard Time.                                                   |

## JSON Configuration

The following is the structure of the JSON configuration for the "Fields to Override DataType" field:
```json
{
"entityTypeId": {
"fieldId": {
"dataType": "ANY_DATA_TYPE",
"lookupValues": [
"value 1",
"value 2"
],
"dependsOn": [
"field_id_1",
"field_id_2"
],
"dateFormat": "M/d/yyyy"
}
}
}
```


### JSON Configuration Parameters

**dataType**  
: Change the datatype of the field, since API only provides limited types: Date, Boolean, Number, Text.

**lookupValues**  
: Specify lookup values manually (only 200 retrieved via API).  
_Recommendation_: Use Excel for mapping if many lookups.

**dependsOn**  
: Some fields require other values when updated.

**dateFormat**  
: Use to override default date format.

### Example
```json
{
"6dd53665c0c24cab86870a21cf6434ae": {
"252b836fc72c4149915053ca1131d138": {
"dataType": "HTML"
},
"9e0b434034e94781ab29598150f388aa": {
"dataType": "LOOKUP",
"dependsOn": [
"1163fda7e6a44f40bb94d2b47cc58f46",
"83c36313e97b4e6b9028aff3b401b71c"
],
"lookupValues": [
"Issue",
"Request"
]
},
"9378aba4eb664c75b19162486199a67ac141aa8dad": {
"dateFormat": "M/d/yyyy"
}
}
}
```


# Supported Entities

* Incident

# Integration Configuration

## Criteria Configuration

* Cherwell supports OpsHub Query Format. See [OpsHub Query format](../integrate/opshub-query-format.md)
* Only these operations are supported: EQUALS, IS, GREATER_THAN, GREATER_THAN_EQUALS, LESS_THAN, LESS_THAN_EQUALS, AND, IN
* Go to [riteria_Configuration](../integrate/integration-configuration.md#criteria-configuration)
* **Important:** Only date fields support two filters with AND. Other fields default to OR due to API limitations.
* Field ID must be passed for the field on which filter is applied.

### Sample Query

Query to search entities where incident ID equals a specific value:

| **Value**                    | **Query**                                                                                  |
|-----------------------------|---------------------------------------------------------------------------------------------|
| Incident ID = 000001        | `[{"field": "6ae282c55e8e4266ae66ffc070c17fa3", "condition": "EQUALS", "value": "14779275"}]` |

Query to search entities belonging to specific teams:

| **Value**                        | **Query**                                                                                                                               |
|----------------------------------|------------------------------------------------------------------------------------------------------------------------------------------|
| Team = Team 1 or Team 2          | `[{"condition": "IN","field": "9339fc404e8d5299b7a7c64de79ab81a1c1ff4306c","values": ["Team 1","Team 2"]}]`                             |

## Target LookUp Configuration

* Provide query in **Target Search Query** field to search the entity in Cherwell when it is the target system.
* See [Search_in_Target_Before_Sync](../integrate/integration-configuration.md#search-in-target-before-sync)
* Target lookup uses the same format as Criteria, with placeholders like `@Title@`

**Example:** [{"condition":"EQUALS","field":"93e8ea93ff67fd95118255419690a50ef2d56f910c","value":"@Title@"}]

This query will select Cherwell entities where **Short Description** = source system **Title**.

# Known Behaviors

* Only last saved state of tickets is synchronized.
* Criteria storage not supported due to lack of NOT EQUALS in Cherwell API.
* Attachments with `#`, `%`, `+` in filename won't sync.
* Comments by service users won't show in journal note history.
* Multilingual characters not supported in fields or attachment names.
* Use JSON to override lookup values if they exceed 200 (API limit).

# Limitations

* History not supported
* Inline images in base64 not supported by {{SITENAME}}
* Linkages not supported
* Only **Incident Note** journal types synchronized as comments
* Only **file type** attachments supported
